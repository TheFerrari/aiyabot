                else:
                    generated = str(res)

            return prompt + generated

    def get_random_word(self, filename):
        chosen_line = None
        try:
            with open(filename, newline='', encoding='utf-8') as csvfile:
                reader = csv.reader(csvfile)
                for count, row in enumerate(reader, start=1):
                    # With probability 1/count, choose the current row
                    if row and random.randrange(count) == 0:
                        chosen_line = row
        except Exception as e:
            print(f"Error reading file: {e}")
            return None

        return chosen_line[0] if chosen_line else None

    @commands.Cog.listener()
    async def on_ready(self):
        self.bot.add_view(viewhandler.DrawView(self))

    @commands.slash_command(name='draw', description='Create an image')
    @option(
        'prompt',
        str,
        description='A prompt to condition the model with.',
        required=False,
    )
    @option(
        'random_prompt',
        str,
        description='Generate a random image from a random prompt.',
        required=False,
        choices=['True', 'Infinite']
    )
    @option(
        'negative_prompt',
        str,
        description='Negative prompts to exclude from output.',
        required=False,
    )
    @option(
        'data_model',
        str,
        description='Select the data model for image generation.',
        required=False,
        autocomplete=discord.utils.basic_autocomplete(settingscog.SettingsCog.model_autocomplete),
    )
    @option(
        'steps',
        int,
        description='The amount of steps to sample the model.',
        min_value=1,
        required=False,
    )
    @option(
        'width',
        int,
        description='Width of the generated image.',
        required=False,
        autocomplete=size_auto,
        choices=settings.global_var.size_range
    )
    @option(
        'height',
        int,
        description='Height of the generated image.',
        required=False,
        autocomplete=size_auto,
        choices=settings.global_var.size_range
    )
    @option(
        'size_ratio',
        str,
        description='Select a size ratio for image generation. This overrides width & height!',
        required=False,
        choices=list(size_ratios.keys())
    )
    @option(
        'guidance_scale',
        str,
        description='Classifier-Free Guidance scale.',
        required=False,
    )
    @option(
        'distilled_cfg_scale',
        str,
        description='Distilled CFG Guidance scale.',
        required=False,
    )
    @option(
        'sampler',
        str,
        description='The sampling method to use for generation.',
        required=False,
        autocomplete=discord.utils.basic_autocomplete(settingscog.SettingsCog.sampler_autocomplete),
    )
    @option(
        'scheduler',
        str,
        description='The schedule type to use for generation.',
        required=False,
        autocomplete=discord.utils.basic_autocomplete(settingscog.SettingsCog.scheduler_autocomplete),
    )
    @option(
        'seed',
        int,
        description='The seed to use for reproducibility.',
        required=False,
    )
    @option(
        'styles',
        str,
        description='Apply a predefined style to the generation.',
        required=False,
        autocomplete=discord.utils.basic_autocomplete(settingscog.SettingsCog.style_autocomplete),
    )
    @option(
        'random_style',
        str,
        description='Choose a style at random.',
        required=False,
        choices=["True"]
    )
    @option(
        'extra_net',
        str,
        description='Apply an extra network to influence the output. To set multiplier, add :# (# = 0.0 - 1.0)',
        required=False,
        autocomplete=discord.utils.basic_autocomplete(settingscog.SettingsCog.extra_net_autocomplete),
    )
    @option(
        'adetailer',
        str,
        description='Choose which details to improve: Faces, Hands, or both.',
        required=False,
        choices=['Faces', 'Hands', 'Faces+Hands', 'Details++']
    )
    #@option(
    #    'poseref',
    #    str,
    #    description='The pose reference image URL.',
    #    required=False,
    #)
    #@option(
    #    'ipadapter',
    #    str,
    #    description='The reference image URL for IPAdapter.',
    #    required=False,
    #)
    @option(
        'highres_fix',
        str,
        description='Tries to fix issues from generating high-res images. Recommended: 4x-UltraMix_Balanced.',
        required=False,
        autocomplete=discord.utils.basic_autocomplete(settingscog.SettingsCog.hires_autocomplete),
    )

    @option(
        'clip_skip',
        int,
        description='Number of last layers of CLIP model to skip.',
        required=False,
        choices=[x for x in range(1, 13, 1)]
    )
    @option(
        'strength',
        str,
        description='The amount in which init_image will be altered (0.0 to 1.0).'
    )
    @option(
        'init_image',
        discord.Attachment,
        description='The starter image for generation. Remember to set strength value!',
        required=False,
    )
    @option(
        'init_url',
        str,
        description='The starter URL image for generation. This overrides init_image!',
        required=False,
    )
    @option(
        'batch',
        str,
        description='The number of images to generate. Batch format: count,size',
        required=False,
    )
    async def dream_handler(self, ctx: discord.ApplicationContext, *,
                            prompt: str,
                            random_prompt: Optional[str] = None,
                            negative_prompt: str = None,
                            data_model: Optional[str] = None,
                            steps: Optional[int] = None,
                            width: Optional[int] = None, 
                            height: Optional[int] = None,
                            size_ratio: Optional[str] = None,
                            guidance_scale: Optional[str] = None,
                            distilled_cfg_scale: Optional[str] = None,
                            sampler: Optional[str] = None,
                            scheduler: Optional[str] = None,
                            seed: Optional[int] = -1,
                            styles: Optional[str] = None,
                            random_style: Optional[str] = None,

                            extra_net: Optional[str] = None,
                            adetailer: Optional[str] = None,
                            highres_fix: Optional[str] = None,
                            clip_skip: Optional[int] = None,
                            strength: Optional[str] = None,
                            init_image: Optional[discord.Attachment] = None,
                            init_url: Optional[str] = None,
                            #poseref: Optional[discord.Attachment] = None,
                            #ipadapter: Optional[discord.Attachment] = None,
                            batch: Optional[str] = None):

        called_from_button = getattr(ctx, 'called_from_button', False)
